var graziosoApp=angular.module("graziosoApp",[]);graziosoApp.controller("DetailsController",["$scope","$rootScope","AnimalService","AnimalTypeService","BreedService",function(n,t,a,e,i){var r,o;t.$on("selectedAnimalUpdated",function(){a.getAnimalDetails().then(function(t){var e;n.animal=t,o=angular.copy(t),n.filterBreeds(),n.animalTypes&&(n.currentAnimalType=n.animalTypes.find(e=>e.Id==t.AnimalTypeId).Name),r&&(e=r.filter(e=>-1<n.animal.BreedIds.indexOf(e.Id)),n.currentBreeds=e.map(e=>e.Name).join("/"))})}),n.toggleEdit=function(e){e.preventDefault(),n.editMode=!n.editMode},n.filterBreeds=function(){r?n.animalTypes&&n.animal&&n.animal.AnimalTypeId?n.breeds=r.filter(e=>e.AnimalTypeId==n.animal.AnimalTypeId):n.breeds=r:n.breeds=null},n.update=function(e){e.preventDefault(),this.editForm.$pristine||a.updateAnimal(n.animal).then(function(e){o=angular.copy(e),t.$emit("selectedAnimalDetailsUpdated"),n.editMode=!1})},n.cancel=function(e){e.preventDefault(),n.editMode=!1,this.editForm.$pristine||(this.editForm.$setPristine(!0),n.animal=angular.copy(o))},e.getAll().then(function(e){n.animalTypes=e,n.filterBreeds()}),i.getAll().then(function(e){r=e,n.filterBreeds()})}]),graziosoApp.controller("MapController",["$scope","$rootScope","AnimalService",function(t,e,n){var a,i;t.initialize=function(){i=new google.maps.Map(document.getElementById("map"))},e.$on("selectedAnimalUpdated",function(){t.selectedAnimal=n.getSelectedAnimal(),a&&a.setMap(null);var e=new google.maps.LatLng(t.selectedAnimal.Latitude,t.selectedAnimal.Longitude);(a=new google.maps.Marker({position:e,title:t.selectedAnimal.Name})).setMap(i),i.panTo(e),i.setZoom(8)}),google.maps.event.addDomListener(window,"load",t.initialize)}]),graziosoApp.controller("TableController",["$scope","$rootScope","AnimalService","AnimalTypeService","BreedService",function(n,t,a,e,i){function r(e){e=e.replace(/\/Date\((.*?)\)\//,"$1");return new Date(parseInt(e))}var o;t.$on("selectedAnimalDetailsUpdated",function(){var t=a.getSelectedAnimal(),e=n.animals.findIndex(e=>e.Id==t.Id);n.animals[e]=t,console.log(n.animals[e])}),n.isOnCurrentPage=function(e){return!(e<(firstRow=(n.currentPage-1)*n.pageSize))&&!(e>(lastRow=n.currentPage*n.pageSize))},n.updateLastPage=function(){var e=Math.trunc(n.animalCount/n.pageSize);n.animalCount%n.pageSize!=0&&e++,n.lastPage=e},n.resetPage=function(){n.currentPage=1},n.setSelectedAnimal=function(e){a.setSelectedAnimal(e),t.$emit("selectedAnimalUpdated")},n.round=function(e,t){t=Math.pow(10,t);return Math.round(e*t)/t},n.setSort=function(e){n.currentPage=1,n.sortKey==e?n.sortKey="-"+e:(n.sortKey,n.sortKey=e)},n.formatDate=function(e){return r(e).toLocaleDateString()},n.animalFilter=function(){return function(e){return!(n.animalId&&!e.AnimalId.toLowerCase().startsWith(n.animalId.toLowerCase()))&&(!(n.animalName&&!e.Name.toLowerCase().startsWith(n.animalName.toLowerCase()))&&(!(n.animalBreed&&!e.Breed.toLowerCase().startsWith(n.animalBreed.toLowerCase()))&&((!n.animalType||e.AnimalType==n.animalType)&&(!(n.dobMin&&r(e.DateOfBirth)<n.dobMin)&&(!(n.dobMax&&r(e.DateOfBirth)>n.dobMax)&&(!(n.dooMin&&r(e.DateOfOutcome)<n.dooMin)&&!(n.dooMax&&r(e.DateOfOutcome)>n.dooMax)))))))}},n.filterBreeds=function(){},(o=new Date).getTimezoneOffset(),n.today=new Date(o).toISOString().substring(0,10),n.currentPage=1,n.pageSize=10,n.pageSizes=[10,15,25,50],e.getAll().then(function(e){n.animalTypes=e}),n.animalType="",n.sortKey="AnimalId",a.getAll().then(function(e){n.animals=e,n.animalCount=e.length,n.updateLastPage(),n.setSelectedAnimal(n.animals[0].Id)})}]),graziosoApp.service("AnimalService",["HttpRequestService",function(t){var n;return{getAll:function(){return t.get("/animals").then(function(e){if(e&&e.models)return animals=e.models})},getSelectedAnimal:function(){return n},setSelectedAnimal:function(t){animals&&(n=animals.find(e=>e.Id==t))},getAnimalDetails:function(){return t.get("/animals/details/"+n.AnimalId).then(function(e){if(e&&e.model)return e.model})},updateAnimal:function(e){return t.post("/animals/details",e).then(function(e){if(e&&e.model)return n=e.model,e.model})}}}]),graziosoApp.service("AnimalTypeService",["HttpRequestService",function(e){var t;return{getAll:function(){return t||e.get("/animaltypes").then(function(e){if(e&&e.models)return t=e.models})}}}]),graziosoApp.service("BreedService",["HttpRequestService",function(e){var t;return{getAll:function(){return t||e.get("/breeds").then(function(e){if(e&&e.models)return t=e.models})}}}]),graziosoApp.service("HttpRequestService",["$http","$q",function(a,i){return{get:function(e,t,n){if(t&&0<t.length)for(x in e+="?",t)e=e+t[x].name+"="+t[x].value,x!=t.length-1&&(e+="&");return a({method:"GET",url:e,headers:n}).then(function(e){return"object"==typeof e.data||"string"==typeof e.data?(e&&e.data&&e.data.exception&&alert("There was an error processing your request."),e.data):(console.log(typeof e.data),i.reject(e.data))},function(e){return i.reject(e.data)})},post:function(e,t,n){return a({method:"POST",url:e,data:t,headers:n}).then(function(e){return"object"==typeof e.data||"string"==typeof e.data?(e&&e.data&&e.data.exception&&alert("There was an error processing your request."),e.data):(console.log(typeof e.data),i.reject(e.data))},function(e){return i.reject(e.data)})}}}]);