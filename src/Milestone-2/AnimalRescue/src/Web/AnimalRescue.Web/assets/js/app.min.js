var graziosoApp=angular.module("graziosoApp",[]),animalService=(graziosoApp.controller("MapController",["$scope","$rootScope","AnimalService",function(t,e,a){var n,o;t.initialize=function(){o=new google.maps.Map(document.getElementById("map"))},e.$on("selectedAnimalUpdated",function(){t.selectedAnimal=a.getSelectedAnimal(),n&&n.setMap(null);var e=new google.maps.LatLng(t.selectedAnimal.LocationLat,t.selectedAnimal.LocationLong);(n=new google.maps.Marker({position:e,title:t.selectedAnimal.Name})).setMap(o),o.panTo(e),o.setZoom(8)}),google.maps.event.addDomListener(window,"load",t.initialize)}]),graziosoApp.controller("TableController",["$scope","$rootScope","AnimalService",function(t,a,n){function o(e){e=e.replace(/\/Date\((.*?)\)\//,"$1");return new Date(parseInt(e))}t.isOnCurrentPage=function(e){return!(e<(firstRow=(t.currentPage-1)*t.pageSize))&&!(e>(lastRow=t.currentPage*t.pageSize))},t.updateLastPage=function(){var e=Math.trunc(t.animalCount/t.pageSize);t.animalCount%t.pageSize!=0&&e++,t.lastPage=e},t.resetPage=function(){t.currentPage=1},t.setSelectedAnimal=function(e){n.setSelectedAnimal(e),a.$emit("selectedAnimalUpdated")},t.round=function(e,t){t=Math.pow(10,t);return Math.round(e*t)/t},t.setSort=function(e){t.currentPage=1,t.sortKey==e?t.sortKey="-"+e:(t.sortKey,t.sortKey=e)},t.formatDate=function(e){return o(e).toLocaleDateString()},t.animalFilter=function(){return function(e){return!(t.animalId&&!e.AnimalId.toLowerCase().startsWith(t.animalId.toLowerCase()))&&(!(t.animalName&&!e.Name.toLowerCase().startsWith(t.animalName.toLowerCase()))&&(!(t.animalBreed&&!e.Breed.toLowerCase().startsWith(t.animalBreed.toLowerCase()))&&((!t.animalType||e.AnimalType==t.animalType)&&(!(t.dobMin&&o(e.DateOfBirth)<t.dobMin)&&(!(t.dobMax&&o(e.DateOfBirth)>t.dobMax)&&(!(t.dooMin&&o(e.Monthyear)<t.dooMin)&&!(t.dooMax&&o(e.Monthyear)>t.dooMax)))))))}},t.init=function(){var e=new Date;e.getTimezoneOffset();t.today=new Date(e).toISOString().substring(0,10),t.currentPage=1,t.pageSize=10,t.pageSizes=[10,15,25,50],t.animalTypes=[{value:"",text:"Any"},{value:"Other",text:"Other"},{value:"Dog",text:"Dog"},{value:"Cat",text:"Cat"},{value:"Bird",text:"Bird"}],t.animalType="",t.sortKey="AnimalId",n.getAll().then(function(e){t.animals=e,t.animalCount=e.length,t.updateLastPage(),t.setSelectedAnimal(t.animals[0].Id)})},t.init()}]),graziosoApp.service("AnimalService",["HttpRequestService",function(e){var a,n;return{getAll:function(){return a||e.get("/animals").then(function(e){if(e&&e.models)return a=e.models})},getSelectedAnimal:function(){return n},setSelectedAnimal:function(t){a&&(n=a.find(e=>e.Id==t))}}}]));graziosoApp.service("HttpRequestService",["$http","$q",function(n,o){return{get:function(e,t,a){if(t&&0<t.length)for(x in e+="?",t)e=e+t[x].name+"="+t[x].value,x!=t.length-1&&(e+="&");return n({method:"GET",url:e,headers:a}).then(function(e){return"object"==typeof e.data||"string"==typeof e.data?(e&&e.data&&e.data.exception&&alert("There was an error processing your request."),e.data):(console.log(typeof e.data),o.reject(e.data))},function(e){return o.reject(e.data)})},post:function(e,t,a){return n({method:"POST",url:e,data:t,headers:a}).then(function(e){return"object"==typeof e.data||"string"==typeof e.data?(e&&e.data&&e.data.exception&&alert("There was an error processing your request."),e.data):(console.log(typeof e.data),o.reject(e.data))},function(e){return o.reject(e.data)})}}}]);